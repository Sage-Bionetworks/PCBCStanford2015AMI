{
    "variables": {
	"aws_access_key": "{{env `AWS_ACCESS_KEY`}}",
	"aws_secret_key": "{{env `AWS_SECRET_KEY`}}"
    },

    "builders": [
	{
	    "type": "amazon-ebs",
	    "access_key": "{{user `aws_access_key`}}",
	    "secret_key": "{{user `aws_secret_key`}}",
	    "region": "us-east-1",
	    "source_ami": "ami-f9ceb79c",
	    "ssh_username": "ubuntu",
	    "ami_name": "ubuntu-PCBC {{timestamp}}",
	    "instance_type": "m3.xlarge",
	    "ami_block_device_mappings": [ {
		"device_name": "/dev/xvda",
		"volume_size": 100,
		"delete_on_termination": true
            } ],
            "launch_block_device_mappings": [ {
		"device_name": "/dev/xvda",
		"volume_size": 100,
		"delete_on_termination": true
            } ]
	},
	{
	     "type": "docker",
	     "image": "ubuntu:14.04",
	     "export_path": "pcbc_docker_image.tar"
	 }],

     "provisioners": [
         {"type": "shell",
          "inline": ["sed -i -e 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config",
                    "service ssh restart"],
          "execute_command": "{{ .Vars }} sudo -E sh '{{ .Path }}'",
          "only": ["amazon-ebs"]
     },
	{
	    "type": "shell",
	    "scripts": ["ec2provisioner.sh", "r_provisioner.sh", "altanalyze_provisioner.sh", "synapseprovisioner.sh"],
	    "pause_before": "10s",
	    "execute_command": "{{ .Vars }} sudo -E sh '{{ .Path }}'",
	    "only": ["amazon-ebs", "docker"]
	},
    {
	    "type": "shell",
	    "scripts": ["x2go_provisioner.sh"],
	    "pause_before": "10s",
	    "execute_command": "{{ .Vars }} sudo -E sh '{{ .Path }}'",
	    "only": ["amazon-ebs"]
	},
    {
        "type": "shell",
        "scripts": ["vnc_provisioner.sh"],
        "pause_before": "10s",
        "execute_command": "{{ .Vars }} sudo -E sh '{{ .Path }}'",
        "only": ["docker"]
    }

    ],

    "post-processors": [
        []
    ]

}
